<blockquote>
<p>Last time I wanted to buy new Samsung Galaxy S 5 I liked blue one
but there was no preorder option on giffgaff website (it was cheapest there)
so to notify me I wrote a bot in pycurl and placed job in cron to send me an email
when ot will be in stock.</p>
</blockquote>
<p>Cut of sourcefragment from giffgaff webpage:</p>
<div class="code"><pre class="code html"><a id="rest_code_cfe025f69b1442c19060014e2999ee5b-1" name="rest_code_cfe025f69b1442c19060014e2999ee5b-1" href="#rest_code_cfe025f69b1442c19060014e2999ee5b-1"></a><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;frmBuyPhone&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/samsung/samsung-galaxy-s5/phone-plans&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">data-color-memory-mapping</span><span class="o">=</span><span class="s">&#39;</span>
<a id="rest_code_cfe025f69b1442c19060014e2999ee5b-2" name="rest_code_cfe025f69b1442c19060014e2999ee5b-2" href="#rest_code_cfe025f69b1442c19060014e2999ee5b-2"></a><span class="s">{&quot;black&quot;:{&quot;16&quot;:{&quot;price&quot;:&quot;517&quot;,&quot;sku&quot;:&quot;GG1SAS5BBN&quot;,&quot;stock&quot;:1,&quot;isLoanAvailable&quot;:true,&quot;minMonthlyPayment&quot;:2139,&quot;minAPR&quot;:970}},</span>
<a id="rest_code_cfe025f69b1442c19060014e2999ee5b-3" name="rest_code_cfe025f69b1442c19060014e2999ee5b-3" href="#rest_code_cfe025f69b1442c19060014e2999ee5b-3"></a><span class="s"> &quot;white&quot;:{&quot;16&quot;:{&quot;price&quot;:&quot;517&quot;,&quot;sku&quot;:&quot;GG1SAS5WWN&quot;,&quot;stock&quot;:1,&quot;isLoanAvailable&quot;:true,&quot;minMonthlyPayment&quot;:2139,&quot;minAPR&quot;:970}},</span>
<a id="rest_code_cfe025f69b1442c19060014e2999ee5b-4" name="rest_code_cfe025f69b1442c19060014e2999ee5b-4" href="#rest_code_cfe025f69b1442c19060014e2999ee5b-4"></a><span class="s"> &quot;blue&quot;:{&quot;16&quot;:{&quot;price&quot;:&quot;517&quot;,&quot;sku&quot;:&quot;GG1SAS5BLN&quot;,&quot;stock&quot;:1,&quot;isLoanAvailable&quot;:true,&quot;minMonthlyPayment&quot;:2139,&quot;minAPR&quot;:970}},</span>
<a id="rest_code_cfe025f69b1442c19060014e2999ee5b-5" name="rest_code_cfe025f69b1442c19060014e2999ee5b-5" href="#rest_code_cfe025f69b1442c19060014e2999ee5b-5"></a><span class="s"> &quot;gold&quot;:{&quot;16&quot;:{&quot;price&quot;:&quot;517&quot;,&quot;sku&quot;:&quot;GG1SAGS5GN&quot;,&quot;stock&quot;:1,&quot;isLoanAvailable&quot;:true,&quot;minMonthlyPayment&quot;:2139,&quot;minAPR&quot;:970}}}&#39;</span>
<a id="rest_code_cfe025f69b1442c19060014e2999ee5b-6" name="rest_code_cfe025f69b1442c19060014e2999ee5b-6" href="#rest_code_cfe025f69b1442c19060014e2999ee5b-6"></a><span class="na">data-loan-mapping</span><span class="o">=</span><span class="s">&#39;{&quot;GG1SAS5BBN&quot;:{&quot;5000&quot;:{&quot;24&quot;:{&quot;deal_id&quot;:&quot;7049&quot;,&quot;apr&quot;:970,&quot;loan_amount&quot;:46700,&quot;monthly_payment&quot;:2139,&quot;total_payment&quot;:56336},&quot;18&quot;:{&quot;deal_id&quot;:&quot;7053&quot;,&quot;apr&quot;:1140,&quot;loan_amount&quot;:46700,&quot;monthly_payment&quot;:2821,&quot;total_payment&quot;:55778},&quot;12&quot;:{&quot;deal_id&quot;:&quot;7057&quot;,&quot;apr&quot;:1470,&quot;loan_amount&quot;:46700,&quot;monthly_payment&quot;:4187,&quot;total_payment&quot;:55244},&quot;6&quot;:{&quot;deal_id&quot;:&quot;7061&quot;,&quot;apr&quot;:2580,&quot;loan_amount&quot;:46700,&quot;monthly_payment&quot;:8317,&quot;total_payment&quot;:54902}}</span>
</pre></div>
<p>The bot looks like this :</p>
<div class="code"><table class="codetable"><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-1"><code data-line-number=" 1"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-1" name="rest_code_17aa882838464f0c8b79803f843b5780-1"></a> <span class="c1">#!/usr/bin/env python</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-2"><code data-line-number=" 2"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-2" name="rest_code_17aa882838464f0c8b79803f843b5780-2"></a> <span class="kn">import</span><span class="w"> </span><span class="nn">pycurl</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-3"><code data-line-number=" 3"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-3" name="rest_code_17aa882838464f0c8b79803f843b5780-3"></a> <span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-4"><code data-line-number=" 4"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-4" name="rest_code_17aa882838464f0c8b79803f843b5780-4"></a> <span class="kn">import</span><span class="w"> </span><span class="nn">cStringIO</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-5"><code data-line-number=" 5"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-5" name="rest_code_17aa882838464f0c8b79803f843b5780-5"></a> <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-6"><code data-line-number=" 6"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-6" name="rest_code_17aa882838464f0c8b79803f843b5780-6"></a> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-7"><code data-line-number=" 7"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-7" name="rest_code_17aa882838464f0c8b79803f843b5780-7"></a> <span class="n">buf</span> <span class="o">=</span> <span class="n">cStringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-8"><code data-line-number=" 8"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-8" name="rest_code_17aa882838464f0c8b79803f843b5780-8"></a> <span class="n">ch</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-9"><code data-line-number=" 9"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-9" name="rest_code_17aa882838464f0c8b79803f843b5780-9"></a> <span class="n">ch</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-10"><code data-line-number="10"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-10" name="rest_code_17aa882838464f0c8b79803f843b5780-10"></a> <span class="n">ch</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">buf</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-11"><code data-line-number="11"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-11" name="rest_code_17aa882838464f0c8b79803f843b5780-11"></a> <span class="n">ch</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">COOKIEJAR</span><span class="p">,</span> <span class="s1">&#39;Ocookie.txt&#39;</span><span class="p">)</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-12"><code data-line-number="12"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-12" name="rest_code_17aa882838464f0c8b79803f843b5780-12"></a> <span class="n">ch</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">USERAGENT</span><span class="p">,</span><span class="s2">&quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; BTRS122288; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.4506.2152; .NET CLR 3.5.30729; InfoPath.3)&quot;</span><span class="p">)</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-13"><code data-line-number="13"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-13" name="rest_code_17aa882838464f0c8b79803f843b5780-13"></a> <span class="k">def</span><span class="w"> </span><span class="nf">get_products</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-14"><code data-line-number="14"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-14" name="rest_code_17aa882838464f0c8b79803f843b5780-14"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ch</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-15"><code data-line-number="15"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-15" name="rest_code_17aa882838464f0c8b79803f843b5780-15"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">ch</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-16"><code data-line-number="16"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-16" name="rest_code_17aa882838464f0c8b79803f843b5780-16"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">buf</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-17"><code data-line-number="17"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-17" name="rest_code_17aa882838464f0c8b79803f843b5780-17"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">newdata</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-18"><code data-line-number="18"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-18" name="rest_code_17aa882838464f0c8b79803f843b5780-18"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">newdata</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;data-color-memory-mapping.*&quot;</span><span class="p">,</span> <span class="n">newdata</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-19"><code data-line-number="19"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-19" name="rest_code_17aa882838464f0c8b79803f843b5780-19"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">newdata</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;blue.*&quot;</span><span class="p">,</span> <span class="n">newdata</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-20"><code data-line-number="20"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-20" name="rest_code_17aa882838464f0c8b79803f843b5780-20"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">newdata</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;stock.:([0-9]{0,2})&quot;</span><span class="p">,</span> <span class="n">newdata</span><span class="p">)</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-21"><code data-line-number="21"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-21" name="rest_code_17aa882838464f0c8b79803f843b5780-21"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">newdata</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-22"><code data-line-number="22"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-22" name="rest_code_17aa882838464f0c8b79803f843b5780-22"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">newdata</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-23"><code data-line-number="23"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-23" name="rest_code_17aa882838464f0c8b79803f843b5780-23"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">print</span> <span class="s2">&quot;not in stock&quot;</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-24"><code data-line-number="24"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-24" name="rest_code_17aa882838464f0c8b79803f843b5780-24"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="k">else</span><span class="p">:</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-25"><code data-line-number="25"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-25" name="rest_code_17aa882838464f0c8b79803f843b5780-25"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;echo &#39;in stock&nbsp;&nbsp;</span><span class="si">%s</span><span class="s2">&#39; | /usr/sbin/sendmail mymail@gmail.com&quot;</span> <span class="o">%</span> <span class="n">newdata</span><span class="p">)</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-26"><code data-line-number="26"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-26" name="rest_code_17aa882838464f0c8b79803f843b5780-26"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nb">print</span> <span class="s2">&quot;in stock&quot;</span>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-27"><code data-line-number="27"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-27" name="rest_code_17aa882838464f0c8b79803f843b5780-27"></a>
</code></td></tr><tr><td class="linenos linenodiv"><a href="#rest_code_17aa882838464f0c8b79803f843b5780-28"><code data-line-number="28"></code></a></td><td class="code"><code><a id="rest_code_17aa882838464f0c8b79803f843b5780-28" name="rest_code_17aa882838464f0c8b79803f843b5780-28"></a> <span class="n">get_products</span><span class="p">(</span><span class="s1">&#39;http://giffgaff.com/samsung/samsung-galaxy-s5/phone-details&#39;</span><span class="p">)</span>
</code></td></tr></table></div><p>and added job to crontab to check every 5 minutes</p>
<p>*/5 * * * * /workspace/projects/checkbot/readweb.py</p>
