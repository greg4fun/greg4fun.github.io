<p>k8s_nfs_persistent_volume</p>
<h1>Create nfs persistent volume:</h1>
<h2>What you need</h2>
<ul>
<li>
<p>NFS Server I have used NFS already installed on my QNAP NAS (You need to enable NO_ROOT_SQUASH on permissions)</p>
</li>
<li>
<p>K8s cluster</p>
</li>
</ul>
<p>Now having your NFS share here 192.168.1.11/Persistentvolume/
you can try if it works with mount </p>
<div class="code"><pre class="code literal-block">sudo mount -t nfs 192.168.1.11:/PersistentVolume /mnt/PersistentVolume
</pre></div>

<p>Later on you can secure access with password.</p>
<p>If everything works fine we need persistent volume on our cluster</p>
<p>persistentvolume.yml</p>
<div class="code"><pre class="code literal-block"><span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">PersistentVolume</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">pv0001</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">capacity</span><span class="o">:</span>
<span class="w">    </span><span class="n">storage</span><span class="o">:</span><span class="w"> </span><span class="mi">100</span><span class="n">Gi</span>
<span class="w">  </span><span class="n">accessModes</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">ReadWriteMany</span>
<span class="w">  </span><span class="n">mountOptions</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">nfsvers</span><span class="o">=</span><span class="mf">4.1</span>
<span class="w">  </span><span class="n">nfs</span><span class="o">:</span>
<span class="w">    </span><span class="n">path</span><span class="o">:</span><span class="w"> </span><span class="sr">/PersistentVolume/</span><span class="n">pv0001</span>
<span class="w">    </span><span class="n">server</span><span class="o">:</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.11</span>
<span class="w">  </span><span class="n">persistentVolumeReclaimPolicy</span><span class="o">:</span><span class="w"> </span><span class="n">Retain</span>
</pre></div>

<p>Apply above yaml to the cluster</p>
<div class="code"><pre class="code literal-block">kubectl apply -f persistentvolume.yml
</pre></div>

<p>Now we need to declare persistent volume claim </p>
<p>persistentvolumeclaim.yml</p>
<div class="code"><pre class="code literal-block"><span class="n">apiVersion</span><span class="o">:</span><span class="w"> </span><span class="n">v1</span>
<span class="n">kind</span><span class="o">:</span><span class="w"> </span><span class="n">PersistentVolumeClaim</span>
<span class="n">metadata</span><span class="o">:</span>
<span class="w">  </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="n">mysql</span><span class="o">-</span><span class="n">pv</span><span class="o">-</span><span class="n">claim</span>
<span class="n">spec</span><span class="o">:</span>
<span class="w">  </span><span class="n">accessModes</span><span class="o">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">ReadWriteMany</span><span class="w"> </span>
<span class="w">  </span><span class="n">resources</span><span class="o">:</span>
<span class="w">    </span><span class="n">requests</span><span class="o">:</span>
<span class="w">      </span><span class="n">storage</span><span class="o">:</span><span class="w"> </span><span class="mi">10</span><span class="n">Gi</span>
</pre></div>

<p>Apply</p>
<div class="code"><pre class="code literal-block">kubectl apply -f persistentvolumeclaim.yml
</pre></div>

<p>Check if it has been bound:</p>
<div class="code"><pre class="code literal-block">kubectl get pv

NAME     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                    STORAGECLASS   REASON   AGE
pv0001   100Gi      RWX            Retain           Bound    default/mysql-pv-claim                           2d4h

kubectl get pvc 
NAME              STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
mysql-pv-claim    Bound     pv0001   100Gi      RWX                           2d4h
</pre></div>